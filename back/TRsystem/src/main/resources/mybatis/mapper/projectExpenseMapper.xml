<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.trsystem.mybatis.mapper.projectExpenseMapper">
	<select id="retrievePrjctCtAplyList" parameterType="map" resultType="com.trsystem.LowerHashMap">
		SELECT
			pca.PRJCT_CT_APLY_SN
			 , pca.EXPENS_CD
			 , CONCAT(SUBSTR(UTZTN_DT, 5, 2),'월 ',SUBSTR(UTZTN_DT,7,2),'일') AS UTZTN_DT
			 , USE_OFFIC
			 , UTZTN_AMT
			 , ATDRN
			 , CT_PRPOS
			 , ELCTRN_ATRZ_ID
			 , CT_ATRZ_SE_CD
			 , (select CD_NM from CD where CD_VALUE = pca.CT_ATRZ_SE_CD) AS 'CT_ATRZ_SE_CD_NM'
	, (select CD_NM from CD where CD_VALUE = pca.EXPENS_CD) AS 'EXPENS_CD_NM'
	, pca.EMP_ID
			 , pca.PRJCT_ID
			 , pca.APLY_YM
			 , pca.APLY_ODR
			 , pcaz.ATRZ_DMND_STTS_CD
			 , (select CD_NM from CD where CD_VALUE = pcaz.ATRZ_DMND_STTS_CD) AS 'ATRZ_DMND_STTS_CD_NM'
	, (SELECT PRJCT_NM FROM PRJCT WHERE PRJCT_ID = pca.PRJCT_ID) AS PRJCT_NM
		FROM PRJCT_CT_APLY pca
				 JOIN PRJCT_CT_ATRZ pcaz
					  ON pca.PRJCT_CT_APLY_SN = pcaz.PRJCT_CT_APLY_SN
						  AND pca.EMP_ID = pcaz.EMP_ID
						  AND pca.APLY_YM = pcaz.APLY_YM
						  AND pca.APLY_ODR = pcaz.APLY_ODR
		WHERE pca.EMP_ID = #{empId}
		  AND pca.APLY_YM = #{aplyYm}
		  AND pca.APLY_ODR = #{aplyOdr}
	</select>
</mapper>

